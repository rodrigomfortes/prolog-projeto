:- dynamic assistido/1.
:- discontiguous filme/2.
:- discontiguous nota/2.

% Filmes e gêneros com notas

% Ficção
filme(interestelar, ficcao).
nota(interestelar, 8.7).
filme(o_mestre_do_spirit, ficcao).
nota(o_mestre_do_spirit, 8.6).
filme(duna, ficcao).
nota(duna, 8.6).
filme(avatar, ficcao).
nota(avatar, 7.8).
filme(planeta_dos_macacos, ficcao).
nota(planeta_dos_macacos, 8.0).
filme(a_chegada, ficcao).
nota(a_chegada, 7.9).
filme(o_senhor_dos_aneis, ficcao).
nota(o_senhor_dos_aneis, 8.8).
filme(matrix_reloaded, ficcao).
nota(matrix_reloaded, 7.2).
filme(her, ficcao).
nota(her, 8.0).
filme(inception, ficcao).
nota(inception, 8.8).
filme(a_maquina_do_tempo, ficcao).
nota(a_maquina_do_tempo, 7.5).

% Ação
filme(matrix, acao).
nota(matrix, 8.7).
filme(o_cavaleiro_das_trevas, acao).
nota(o_cavaleiro_das_trevas, 9.0).
filme(gladiador, acao).
nota(gladiador, 8.5).
filme(vingadores_ultimato, acao).
nota(vingadores_ultimato, 8.4).
filme(o_protegido, acao).
nota(o_protegido, 7.3).
filme(vingadores_infinity_war, acao).
nota(vingadores_infinity_war, 8.5).
filme(mission_impossible_fallout, acao).
nota(mission_impossible_fallout, 8.0).
filme(skyfall, acao).
nota(skyfall, 8.0).
filme(john_wick, acao).
nota(john_wick, 7.8).
filme(the_dark_knight_rises, acao).
nota(the_dark_knight_rises, 8.4).

% Aventura
filme(jurassic_park, aventura).
nota(jurassic_park, 8.1).
filme(o_senhor_dos_aneis_o_retorno_do_rei, aventura).
nota(o_senhor_dos_aneis_o_retorno_do_rei, 9.0).
filme(harry_potter_e_a_pedra_filosofal, aventura).
nota(harry_potter_e_a_pedra_filosofal, 8.3).
filme(o_hobbit_uma_viagem_inesperada, aventura).
nota(o_hobbit_uma_viagem_inesperada, 7.8).
filme(piratas_do_carambo, aventura).
nota(piratas_do_carambo, 8.0).
filme(quest_for_fire, aventura).
nota(quest_for_fire, 7.0).
filme(the_lord_of_the_rings_the_two_towers, aventura).
nota(the_lord_of_the_rings_the_two_towers, 8.7).
filme(narnia, aventura).
nota(narnia, 7.5).
filme(guardians_of_the_galaxy, aventura).
nota(guardians_of_the_galaxy, 8.0).
filme(marvels_the_avengers, aventura).
nota(marvels_the_avengers, 8.0).

% Fantasia
filme(harry_potter, fantasia).
nota(harry_potter, 8.3).
filme(a_vida_e_bela, fantasia).
nota(a_vida_e_bela, 8.6).
filme(o_senhor_dos_aneis_a_companhia_do_anel, fantasia).
nota(o_senhor_dos_aneis_a_companhia_do_anel, 8.8).
filme(e_um_mundo_maravilhoso, fantasia).
nota(e_um_mundo_maravilhoso, 8.6).
filme(um_mundo_dentro_de_um_mundo, fantasia).
nota(um_mundo_dentro_de_um_mundo, 7.7).
filme(o_senhor_dos_aneis_as_duas_torres, fantasia).
nota(o_senhor_dos_aneis_as_duas_torres, 8.7).
filme(magic_kingdom, fantasia).
nota(magic_kingdom, 7.5).
filme(stardust, fantasia).
nota(stardust, 7.7).
filme(chronicles_of_narnia, fantasia).
nota(chronicles_of_narnia, 7.6).
filme(aladdin, fantasia).
nota(aladdin, 8.0).

% Drama
filme(o_resgate_do_shawshank, drama).
nota(o_resgate_do_shawshank, 9.3).
filme(os_12_homens_decentes, drama).
nota(os_12_homens_decentes, 9.0).
filme(clube_da_luta, drama).
nota(clube_da_luta, 8.8).
filme(forrest_gump, drama).
nota(forrest_gump, 8.8).
filme(a_lista_de_schindler, drama).
nota(a_lista_de_schindler, 9.0).
filme(boyhood, drama).
nota(boyhood, 8.0).
filme(moonlight, drama).
nota(moonlight, 8.0).
filme(whiplash, drama).
nota(whiplash, 8.5).
filme(the_pursuit_of_happiness, drama).
nota(the_pursuit_of_happiness, 8.0).
filme(citizen_kane, drama).
nota(citizen_kane, 8.3).

% Comédia
filme(o_mestre, comedia).
nota(o_mestre, 8.1).
filme(o_grande_heroi, comedia).
nota(o_grande_heroi, 7.5).
filme(tempos_modernos, comedia).
nota(tempos_modernos, 8.5).
filme(a_vida_e_bela, comedia).
nota(a_vida_e_bela, 8.6).
filme(somente_uma_vez, comedia).
nota(somente_uma_vez, 7.6).
filme(luzes_da_cidade, comedia).
nota(luzes_da_cidade, 8.5).
filme(the_grand_budapest_hotel, comedia).
nota(the_grand_budapest_hotel, 8.1).
filme(mrs_doubtfire, comedia).
nota(mrs_doubtfire, 7.0).
filme(ace_ventura, comedia).
nota(ace_ventura, 7.7).
filme(dumb_and_dumber, comedia).
nota(dumb_and_dumber, 7.3).

% Animação
filme(o_rei_leao, animacao).
nota(o_rei_leao, 8.5).
filme(frozen, animacao).
nota(frozen, 7.5).
filme(shrek, animacao).
nota(shrek, 8.1).
filme(up, animacao).
nota(up, 8.3).
filme(moana, animacao).
nota(moana, 7.6).
filme(toy_story, animacao).
nota(toy_story, 8.3).
filme(inside_out, animacao).
nota(inside_out, 8.1).
filme(coco, animacao).
nota(coco, 8.4).
filme(zootopia, animacao).
nota(zootopia, 8.0).
filme(big_hero_6, animacao).
nota(big_hero_6, 7.8).
filme(o_exorcista, terror).
nota(o_exorcista, 8.0).
filme(psicose, terror).
nota(psicose, 8.5).
filme(silencio_dos_inocentes, terror).
nota(silencio_dos_inocentes, 8.6).
filme(a_noite_dos_mortos_vivos, terror).
nota(a_noite_dos_mortos_vivos, 7.9).
filme(o_brilho, terror).
nota(o_brilho, 8.4).
filme(a_bruxa, terror).
nota(a_bruxa, 7.1).
filme(o_projeto_blair_witch, terror).
nota(o_projeto_blair_witch, 6.4).
filme(insidious, terror).
nota(insidious, 7.6).
filme(saw, terror).
nota(saw, 7.6).
filme(the_ring, terror).
nota(the_ring, 7.2).

% Recomendação de filmes com base em gênero e nota
recomendar(Gostos, Filme, Nota) :-
    filme(Filme, Genero),
    nota(Filme, Nota),
    member(Genero, Gostos),
    \+ assistido(Filme).  % Garante que o filme não foi assistido

% Top 3 filmes baseado na nota, sempre retorna os 3 primeiros
top_3_filmes(Gostos, Top3) :-
    findall([Filme, Nota], recomendar(Gostos, Filme, Nota), Filmes), % Pega todos os filmes recomendados com suas notas
    sort(2, @>=, Filmes, FilmesOrdenados),  % Ordena os filmes pela nota em ordem decrescente
    first_n(3, FilmesOrdenados, Top3).  % Pega os 3 primeiros filmes (maiores notas)

% Auxiliar para pegar os 3 primeiros filmes da lista ordenada

first_n(N, [X|T], [X|Result]) :- 
    N > 0,  % Se N for maior que 0
    N1 is N - 1,  % Decremente N
    first_n(N1, T, Result).  % Continue recursivamente pegando os primeiros N

% Caso N seja 0, retorne uma lista vazia
first_n(0, _, []).  

% Marcar filme como assistido
marcar_assistido(Filme) :-
    assert(assistido(Filme)).
    